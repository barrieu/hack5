<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-call-function@1.1.0"></script>
    <link href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" rel="stylesheet" type="text/css" />

    <audio id="audio" src="oodlesOfSounds.ogg" preload="auto"></audio>

  </head>

  <body>
    <div id="jspsych_target"></div>
    <button onclick="dummyPress()">Press to Activate Audio</button>
    <button onclick="playTheTones()">sound the tone</button>
  </body>

  <script>
  console.log("setting up audiocontext at ver 5 ");
  const audioContext = new AudioContext();
  const element = document.querySelector("audio");
  const source = audioContext.createMediaElementSource(element);
  const gainNode = audioContext.createGain();

  gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
  element.connect(gainNode);
  gainNode.connect(audioContext.destination);

  function dummyPress(){
    audioContext.resume();
    playTheTones();
  };


  function playTheTones(){
       element.currentTime = 2;
       gainNode.gain.exponentialRampToValueAtTime(1.0, audioContext.currentTime + 0.1);

       setTimeout(function(){
         gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
       },900);

       element.start();
       console.log("PLAYING 2   " + element.currentTime);
       var k = setInterval(function(){
         element.pause();
         clearInterval(k);
         console.log("STOPPED");
       },1000);

       setTimeout(function(){
            element.currentTime = 250;
            gainNode.gain.exponentialRampToValueAtTime(1.0, audioContext.currentTime + 0.1);

            setTimeout(function(){
              gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
            },900);

            element.start();
            console.log("PLAYING 250   " + element.currentTime);
            var k = setInterval(function(){
              element.pause();
              clearInterval(k);
              console.log("STOPPED");
            },1000);

          },1000);

      };


  </script>
</html>
